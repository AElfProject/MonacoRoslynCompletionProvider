<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monaco Roslyn C# Code Completion Sample</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h2>Monaco Editor Sample</h2>
		<div id="container" style="width: 800px; height: 600px; border: 1px solid grey"></div>

		<!-- OR ANY OTHER AMD LOADER HERE INSTEAD OF loader.js -->
		<script src="nm/monaco-editor/min/vs/loader.js"></script>
		<script>
			require.config({ paths: { vs: 'nm/monaco-editor/min/vs' } });

			require(['vs/editor/editor.main'], function () {
                monaco.languages.registerCompletionItemProvider('csharp', {
                    triggerCharacters: [".", "("],
                    provideCompletionItems: async (model, position) => {
                        var textUntilPosition = model.getValueInRange({startLineNumber: 1, startColumn: 1, endLineNumber: position.lineNumber, endColumn: position.column});
                        var suggestions = [];

                        let request = {
                            Code: model.getValue(),
                            Position: textUntilPosition.length,
                            Assemblies: null
                        }

                        console.log(request);

                        /*let response = await fetch("/completion", {
                            method: 'POST',
                            body: JSON.stringify(request),
                        });
                        let resultQ = await response.json();*/

                        let resultQ = await axios.post("/completion", JSON.stringify(request))

                        for (let elem of resultQ.data) {
                                suggestions.push({
                                    label: elem.Suggestion,
                                    kind: monaco.languages.CompletionItemKind.Function,
                                    insertText: elem.Suggestion,
                                    documentation: elem.Description
                                });
                            }

                        return { suggestions: suggestions };
                    }
                });

				var editor = monaco.editor.create(document.getElementById('container'), {
					value: "using System;\n\npublic class MyClass\n{\n\tpublic static void MyMethod(int value)\n\t{\n\t\tGuid.\n\t}\n}",
					language: 'csharp'
				});
			});
		</script>
</body>
</html>